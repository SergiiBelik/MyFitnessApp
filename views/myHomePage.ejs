<html>
  <head>
    <title>Fitness App</title>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
      <link rel="stylesheet" href="/css/main.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
      <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  </head>
    <body>
      <h1>Home Page</h1>
      <h2><%= day%></h2>
      <div>
          <a href='/logout' style="position: absolute;top: 0px;right: 10px;">Sign out</a>
      </div>
      <form action='/myhomepage' method='GET'>
        <input type='text' name='calendar' id='calendar' placeholder='Pick a date'>
        <input type='Submit' value='GO!'>
      </form>
        <div id='breakfast'>
          <h2 style='display: inline-block'>Breakfast</h2>
          <span style='display: inline-block; position: absolute; left: 800px'>Protein  |</span>
          <span style='display: inline-block; position: absolute; left: 870px'>Carbs  |</span>
          <span style='display: inline-block; position: absolute; left: 930px'>Fat</span>
          <div><button id='breakfast'>Add</button></div>
                <% if(typeof(day) == 'undefined'){%>
                    <% let pickedDate = new Date()%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'breakfast' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                                <span id="productName"><%= product["report"]["food"]["name"] %> - <%=product.report.amount%><%=product.report.measure%>
                                  <form action='/myhomepage?_method=DELETE' method='POST' id='addForm'>
                                    <button value='<%= product._id%>' name='remove'>Remove</button>
                                  </form>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '203'){%>
                                        <span style='position: absolute; left: 800px'><%= Math.floor(nutrient.value * (product.report.amount/100)) %></span>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '204'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '205'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                </span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                      <span>Per <%=product.report.amount%><%=product.report.measure%></span>
                                      
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p>
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                      <span id="nutrmeasure"><%= Math.floor(nutrient.value * (product.report.amount/100)) %><%= nutrient.unit %></span>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% } else {%>
                    <% let pickedDate = new Date(day)%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'breakfast' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %> - <%=product.report.amount%><%=product.report.measure%>
                                  <form action='/myhomepage?_method=DELETE' method='POST' id='addForm'>
                                    <button value='<%= product._id%>' name='remove'>Remove</button>
                                  </form>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '203'){%>
                                        <span style='position: absolute; left: 800px'><%= Math.floor(nutrient.value * (product.report.amount/100)) %></span>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '204'){%>
                                        <span style='position: absolute; left: 930px'><%= Math.floor(nutrient.value * (product.report.amount/100)) %></span>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '205'){%>
                                        <span style='position: absolute; left: 870px'><%= Math.floor(nutrient.value * (product.report.amount/100)) %></span>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                </span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                      <span>Per <%=product.report.amount%><%=product.report.measure%></span>
                                      
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p>
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                      <span id="nutrmeasure"><%= Math.floor(nutrient.value * (product.report.amount/100)) %><%= nutrient.unit %></span>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% }%>
        </div>
        <div id='lunch'>
          <h2 style='display: inline-block'>Lunch</h2>
          <span style='display: inline-block; position: absolute; left: 800px'>Protein  |</span>
          <span style='display: inline-block; position: absolute; left: 870px'>Carbs  |</span>
          <span style='display: inline-block; position: absolute; left: 930px'>Fat</span>
          <div><button id='lunch'>Add</button></div>
                <% if(typeof(day) == 'undefined'){%>
                    <% let pickedDate = new Date()%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'lunch' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %> - <%=product.report.amount%><%=product.report.measure%>
                                  <form action='/myhomepage?_method=DELETE' method='POST' id='addForm'>
                                    <button value='<%= product._id%>' name='remove'>Remove</button>
                                  </form>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '203'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '204'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '205'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                </span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                      <span>Per <%=product.report.amount%><%=product.report.measure%></span>
                                      
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p>
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                      <span id="nutrmeasure"><%= Math.floor(nutrient.value * (product.report.amount/100)) %><%= nutrient.unit %></span>
                                  </div>
                                  <% }); %>
                            
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% } else {%>
                    <% let pickedDate = new Date(day)%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'lunch' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %> - <%=product.report.amount%><%=product.report.measure%>
                                  <form action='/myhomepage?_method=DELETE' method='POST' id='addForm'>
                                    <button value='<%= product._id%>' name='remove'>Remove</button>
                                  </form>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '203'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '204'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '205'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                </span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                      <span>Per <%=product.report.amount%><%=product.report.measure%></span>
                                      
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p>
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                      <span id="nutrmeasure"><%= Math.floor(nutrient.value * (product.report.amount/100)) %><%= nutrient.unit %></span>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% }%>
        </div>
        <div id='dinner'>
          <h2 style='display: inline-block'>Dinner</h2>
          <span style='display: inline-block; position: absolute; left: 800px'>Protein  |</span>
          <span style='display: inline-block; position: absolute; left: 870px'>Carbs  |</span>
          <span style='display: inline-block; position: absolute; left: 930px'>Fat</span>
          <div><button id='dinner'>Add</button></div>
                <% if(typeof(day) == 'undefined'){%>
                    <% let pickedDate = new Date()%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'dinner' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %> - <%=product.report.amount%><%=product.report.measure%>
                                  <form action='/myhomepage?_method=DELETE' method='POST' id='addForm'>
                                    <button value='<%= product._id%>' name='remove'>Remove</button>
                                  </form>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '203'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '204'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '205'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                </span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                      <span>Per <%=product.report.amount%><%=product.report.measure%></span>
                                      
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p>
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                      <span id="nutrmeasure"><%= Math.floor(nutrient.value * (product.report.amount/100)) %><%= nutrient.unit %></span>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% } else {%>
                    <% let pickedDate = new Date(day)%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'dinner' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>


                                <span id="productName"><%= product["report"]["food"]["name"] %> - <%=product.report.amount%><%=product.report.measure%>
                                  <form action='/myhomepage?_method=DELETE' method='POST' id='addForm'>
                                    <button value='<%= product._id%>' name='remove'>Remove</button>
                                  </form>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '203'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '204'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                  <h3 id='addForm'>
                                    <% product.report.food.nutrients.forEach(nutrient => {%>
                                      <% if(nutrient.nutrient_id == '205'){%>
                                        <%= Math.floor(nutrient.value * (product.report.amount/100)) %>
                                      <% }%>
                                    <% })%>
                                  </h3>
                                </span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                      <span>Per <%=product.report.amount%><%=product.report.measure%></span>
                                      
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p>
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                      <span id="nutrmeasure"><%= Math.floor(nutrient.value * (product.report.amount/100)) %><%= nutrient.unit %></span>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% }%>
        </div>



      <script>
        flatpickr("#calendar", {dateFormat: "m/d/Y"})
      </script>
      <script type="text/javascript" src="javascript/listcollapse.js"></script>
      <script type="text/javascript" src='javascript/addNewProduct.js'></script>
    </body>
</html>
