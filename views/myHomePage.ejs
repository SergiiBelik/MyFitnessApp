<html>
  <head>
    <title>Fitness App</title>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
      <link rel="stylesheet" href="/css/main.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
      <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  </head>
    <body>
      <h1>Home Page</h1>
      <div>
          <a href='/logout'>Sign out</a>
      </div>
      <form action='/myhomepage' method='GET'>
        <input type='text' name='calendar' id='calendar' placeholder='Pick a date'>
        <input type='Submit' value='GO!'>
      </form>
        <div id='breakfast'>
          <h2>Breakfast</h2>
          <button id='breakfast'>Add</button>
                <% if(typeof(day) == 'undefined'){%>
                    <% let pickedDate = new Date()%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'breakfast' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %></span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p> - 
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% } else {%>
                    <% let pickedDate = new Date(day)%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'breakfast' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %></span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p> - 
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% }%>
        </div>
        <div id='lunch'>
          <h2>Lunch</h2>
          <button id='lunch'>Add</button>
                <% if(typeof(day) == 'undefined'){%>
                    <% let pickedDate = new Date()%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'lunch' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %></span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p> - 
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                  </div>
                                  <% }); %>
                            
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% } else {%>
                    <% let pickedDate = new Date(day)%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'lunch' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                <span id="productName"><%= product["report"]["food"]["name"] %></span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p> - 
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% }%>
        </div>
        <div id='dinner'>
          <h2>Dinner</h2>
          <button id='dinner'>Add</button>
                <% if(typeof(day) == 'undefined'){%>
                    <% let pickedDate = new Date()%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'dinner' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                            
                                  <span id="productName"><%= product["report"]["food"]["name"] %></span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p> - 
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% } else {%>
                    <% let pickedDate = new Date(day)%>
                    <% user.products.forEach(function(product){%>
                        <% let d = new Date(product.report.date)%>
                        <% if(product.report.when == 'dinner' && (d.getDate() == pickedDate.getDate() && d.getMonth() == pickedDate.getMonth() && d.getYear() == pickedDate.getYear())){ %>
                            <li>
                                <span id="productName"><%= product["report"]["food"]["name"] %></span>
                                  <div class="hidden" id="firstRow">
                                      <div id="nutrname">Nutrient</div>  
                                      <span id="nutrmeasure">Per 100g</span> 
                                      <%product["report"]["food"]["nutrients"][0]["measures"].forEach(function(measure){ %>
                                          <span><%= measure.qty %> <%= measure.label %></span>
                                      <% }) %>
                                  </div>
                                  <% product["report"]["food"]["nutrients"].forEach(function(nutrient){ %>
                                  <div class="hidden">
                                      <p id="nutrname"><%= nutrient.name %></p> - 
                                      <span id="nutrmeasure"><%= nutrient.value %><%= nutrient.unit %></span>
                                      <% nutrient["measures"].forEach(function(measure){ %>
                                      <span><%= measure.value%><%= measure.eunit%></span>
                                      <% }) %>
                                  </div>
                                  <% }); %>
                            
                            </li>
                        <% }%>
                    <% }) %>
                <% }%>
        </div>



      <script>
        flatpickr("#calendar", {})
      </script>
      <script type="text/javascript" src="javascript/listcollapse.js"></script>
      <script type="text/javascript" src='javascript/addNewProduct.js'></script>
    </body>
</html>
